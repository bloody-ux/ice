<% if(appWorkerPath) {-%>import '<%- appWorkerPath %>';<% } -%>
<% if(!!loaders && !!dataLoader && useAppWorker) {-%>
import dataloaderConfig from './dataloader-config';

addEventListener('beforepageload', async (pageInfos = {}) => {
  const {
    key,
  } = pageInfos.detail || {};
  const config = dataloaderConfig[key];
  if (config && config.loader) {
    const loader = config.loader;
    if (typeof loader === 'function') {
      const res = await loader();
      pha.postMessage({
        index: 0,
        data: res,
      }, key);
    } else if (Array.isArray(loader)) {
      loader.forEach(async (item, index) => {
        if (typeof item === 'function') {
          const res = await item();
          pha.postMessage({
            data: res,
            index,
          }, key);
        }
      });
    }
  }
});
<% } -%>
